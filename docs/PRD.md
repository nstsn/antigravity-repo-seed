# PRD: AI Thread Renamer Side Panel (Chrome Extension)

## 1. 概要
ChatGPT や Gemini を Chrome で利用する際、会話スレッドの「リネーム」に手数が多い。
本拡張は Side Panel からアクティブなスレッドを素早くリネームできるようにし、
タイトル先頭に日付（YYMMDD_）を自動挿入し、末尾にユーザが選んだハッシュタグを付ける。

## 2. ゴール / 成功指標
- ゴール：
  - サイドパネルから最短操作でリネームできる
  - 日付プレフィックスの自動付与が安定する
  - タグはユーザ登録リストから選べ、無限生成されない
  - リネーム済みスレッドだけを検索し、ワンクリックでジャンプできる
  - ショートカットで起動できる
  - 安全装置（プレビュー、Undo、失敗理由）で事故を防ぐ
- 成功指標（例）：
  - リネーム完了までの操作回数・時間が体感で半減
  - 誤リネームをUndoで回復できる
  - DOM変更で壊れた際に「原因が分かる」メッセージが出る

## 3. 想定ユーザー
- AIチャットを日常的に使う人（仕事/学習）
- 会話ログを後から検索・整理したい人

## 4. ユースケース
- 相談や調査をした直後、会話タイトルを `YYMMDD_内容 #タグ` にする
- タグや期間で過去の“リネーム済み”会話を探し、すぐ開く
- リネームミスを直後にUndoする

## 5. 機能要件（MVP）
### 5.1 リネーム（主機能）
- サイドパネルを開くと「現在タブの対象サイト判定」を行う（ChatGPT/Gemini）
- アクティブスレッドに対してリネーム実行ができる
- タイトル生成規則：
  - 先頭：`YYMMDD_`（例：2026/01/18 → `260118_`）
  - 本文：ユーザ入力（例：`chrome拡張相談`）
  - 末尾：タグがある場合のみ ` 半角スペース + #tag1 #tag2 ...`
- タグ仕様：
  - ユーザ登録リストからのみ選択可能（新規自動生成なし）
  - 自動提案はランキング提示まで
  - 自動“確定”は最大1つ（スコア閾値を超えた場合のみ）
  - 最大タグ数：3（デフォルト）

### 5.2 安全装置
- 変更前タイトル/変更後タイトルのプレビュー表示
- 実行後、一定時間 Undo（元に戻す）を提供
- 失敗時は理由と推奨アクションを表示

### 5.3 ショートカット
- キーボードショートカットでサイドパネルを開ける
- 開いたら本文入力にフォーカスする

### 5.4 リネーム済み検索（インデックスは拡張がリネーム成功したもののみ）
- フィルタ：
  - タグ（完全一致）
  - 期間（`YYMMDD_` の範囲）
  - フリーワード（タイトル部分一致）
- 結果からワンクリックでスレッドへジャンプ（同タブ/新タブ）

## 6. 非機能要件
- プライバシー：
  - 会話内容を外部送信しない
  - タグリスト・インデックスはローカル保存
- 信頼性：
  - DOM変更に備え、アダプタ分離、冗長セレクタ、失敗理由の可視化
- パフォーマンス：
  - サイドパネル起動が重くならない（インデックス検索はローカルで高速）

## 7. 対応範囲 / 非対応（明確化）
- 対応：
  - ChatGPT / Gemini の「スレッドタイトル変更」UIを自動操作（DOM経由）
- 非対応（当面）：
  - リネームしていないスレッド全件の検索（網羅スクレイピングはしない）
  - タグのAI自動生成（無限生成防止）

## 8. 既知のリスク
- サイトのUI/DOM変更でリネーム手順が壊れる可能性
  - 対策：アダプタ分離、冗長セレクタ、失敗理由の可視化、素早い修正が可能な構造
